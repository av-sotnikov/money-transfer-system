# üí≥ Payment System (Test Project)

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞–≤—ã–∫–æ–≤ —Ä–∞–±–æ—Ç—ã —Å Spring Boot, PostgreSQL, Redis, Liquibase –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏–∑ 3 —Å–ª–æ—ë–≤ (API,
Service, DAO). –í–∫–ª—é—á–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –±–∞–ª–∞–Ω—Å–∞–º–∏ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.
---

## ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ —Ä–∞–±–æ—Ç—ã

### - –ü—Ä–æ–≥—Ä–µ—Ç—ã–π –∫—ç—à

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤ Redis –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü—è –æ –≥–æ—Ä—è—á–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:

1) "balance:user:1" - —Ç–µ–∫—É—â–∏–π/—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2) "last_accrual:user:1" - –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
3) "initial_deposit:user:1" - –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞

### - –õ–µ–Ω–∏–≤–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ http://localhost:8080/api/v1/accounts/balance –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –¥–µ–ø–æ–∑–∏—Ç–∞, –¥–∞–ª–µ–µ –æ–Ω–æ
—Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º –∏ –¥–µ–ª–∏—Ç—å—Å—è –Ω–∞ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –≤ —à–∞–≥–µ –ø–æ 30 —Å–µ–∫—É–Ω–¥. –ü–æ–ª—É—á–∏–≤—à–∏–π—Å—è elapsed —É—á–∞—Å—Ç–≤—É–µ—Ç –≤
—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—É–º–º—ã –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è, –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º –∫–∞–∫ –∏—Ç–µ—Ä–∞—Ç–æ—Ä/—Å—á–µ—Ç—á–∏–∫ –¥–ª—è —Å—É–º–º—ã –≤ 10% –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞:

#### ((NOW() - LastAccrualTime) / 30 —Å–µ–∫—É–Ω–¥) * 10% –æ—Ç initial_deposit = –°–£–ú–ú–ê ACCRUAL;

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å, + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –µ–≥–æ –≤ –∂—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π transaction –∏ account
–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
–∏ –≤ redis –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

–î–∞–ª–µ–µ –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å –¥–æ—Å—Ç–∏–≥ 207% –æ—Ç –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞, –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —á–µ—Ä–µ–∑ –∫—ç—à –¥–ª—è –≥–æ—Ä—è—á–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –º–∏–Ω—É—é
–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π —Å–ª–æ–π.
–¢–∞–∫ –∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω TTL –¥–ª—è redis, –µ—Å–ª–∏ get** api –Ω–µ –¥–µ—Ä–≥–∞–µ—Ç—Å—è 10 –º–∏–Ω—É—Ç –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–∞—é—Ç—Å—è —Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–∫—Ç–∏–≤–Ω—ã–π.

–î–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–µ–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ –ë–î –¥–µ–ª–∞—è —Ä–∞–±–æ—Ç—É –±–æ–ª–µ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä
–¥–ª—è 1 000 000 —Å—á–µ—Ç–æ–≤.

+ –î–µ—à–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –∏–∑ –∫—ç—à–∞ (–ë—ã—Å—Ç—Ä—ã–π –æ–ø—Ä–æ—Å –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞).

### - –ì–∏–±—Ä–∏–¥–Ω–∞—è –º–æ–¥–µ–ª—å —Ö—Ä–∞–Ω–µ–Ω–∏—è

–ë—ã–ª –≤–≤–µ–¥–µ–Ω –∂—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π / –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π. –î–ª—è —Ç–æ—á–Ω–æ–π —Ñ–∏–∫c–∞—Ü–∏–∏ –ø—Ä–æ–≤–æ–¥–æ–∫ –∏ –∫–∞–∫ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è –±—É–¥—É—é—â–µ–≥–æ
—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ -
–ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

![Transaction Diagram](docs/trasaction.png)
---

–°—Ö–µ–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫:

![Radison Diagram](docs/radison_lock.png)

---

## ‚öôÔ∏è –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `payment`.

```bash
createdb -U postgres payment
````

## üì¶üìå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (Postgres)

```bash
cp .env.example .env
````

### –ó–∞—Ç–µ–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –ø–æ–¥ —Å–≤–æ—ë –æ–∫—Ä—É–∂–µ–Ω–∏–µ

---

## üß™ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

````markdown
mvn clean package
java -jar ./target/payment-0.0.1-SNAPSHOT.jar
mvn spring-boot:run
````

---

### –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ open-api

### üëâ [–û–ø–∏—Å–∞–Ω–∏–µ api –∏ –º–æ–¥–µ–ª–µ–π](http://localhost:8080/swagger-ui/index.html#/)

---

## üõ†Ô∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- Java 11
- Spring Boot
- Spring Security (JWT)
- PostgreSQL
- Redis (–∫—ç—à –±–∞–ª–∞–Ω—Å–æ–≤)
- Liquibase (–º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- Maven
- Testcontainers (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã)
- Swagger (OpenAPI 3)

---

## üì¶ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- `API Layer` ‚Äî REST-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
- `Service Layer` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- `DAO Layer` ‚Äî —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ JPA
- `DTO/Mapper` ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `Scheduled` ‚Äî —Ñ–æ–Ω–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤
- `Redis` ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–∞–ª–∞–Ω—Å–æ–≤

---

## üìÑ –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ email/phone + password (JWT)
- üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ `email`, `phone`, `name`, `dateOfBirth` —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- ‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ email/phone —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ–±—è
- üí∞ –¢—Ä–∞–Ω—Å—Ñ–µ—Ä —Å—Ä–µ–¥—Å—Ç–≤ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- üìà –ê–≤—Ç–æ–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –∫ –±–∞–ª–∞–Ω—Å—É (–¥–æ 207% –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞)
- üßæ –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

---

## üß™ –¢–µ—Å—Ç—ã

- ‚úÖ –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è –ª–æ–≥–∏–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ Testcontainers + MockMvc

---